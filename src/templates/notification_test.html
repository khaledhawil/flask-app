{% extends "base.html" %}

{% block title %}ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª{% endblock %}

{% block extra_css %}
<style>
    .test-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        direction: rtl;
    }

    .test-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
    }

    .test-section {
        background: white;
        margin: 20px 0;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-right: 4px solid #667eea;
    }

    .test-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
        transition: transform 0.2s;
    }

    .test-btn:hover {
        transform: translateY(-2px);
    }

    .test-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
    }

    .status-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-right: 3px solid #28a745;
    }

    .status-error {
        border-right-color: #dc3545;
        background: #fff5f5;
    }

    .status-warning {
        border-right-color: #ffc107;
        background: #fffbf0;
    }

    .permission-status {
        font-weight: bold;
        color: #667eea;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }

    .stat-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
    }

    .stat-number {
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
    }

    .notification-log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin: 20px 0;
        max-height: 200px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
    }

    .log-entry {
        margin: 5px 0;
        padding: 5px;
        background: white;
        border-radius: 4px;
        border-right: 3px solid #007bff;
    }

    .prayer-times-card {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        color: #333;
        padding: 20px;
        border-radius: 10px;
        margin: 10px 0;
    }

    .prayer-time-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .prayer-time-item:last-child {
        border-bottom: none;
    }

    .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }

    .setting-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
    }

    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .toggle-slider {
        background-color: #667eea;
    }

    input:checked + .toggle-slider:before {
        transform: translateX(26px);
    }
</style>
{% endblock %}

{% block content %}
<div class="test-container">
    <div class="test-header">
        <h1>ğŸ”” ØªØ¬Ø±Ø¨Ø© ÙˆØ§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</h1>
        <p>Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØªÙƒÙˆÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</p>
    </div>

    <!-- Permission Status -->
    <div class="test-section">
        <h3>ğŸ” Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª</h3>
        <div id="permissionStatus" class="status-card">
            <div class="permission-status">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª...</div>
        </div>
        <button class="test-btn" onclick="requestPermission()">Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</button>
    </div>

    <!-- Quick Tests -->
    <div class="test-section">
        <h3>âš¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
        <button class="test-btn" onclick="testBasicNotification()">ØªØ¬Ø±Ø¨Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø£Ø³Ø§Ø³ÙŠ</button>
        <button class="test-btn" onclick="testAchievementNotification()">ØªØ¬Ø±Ø¨Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ù†Ø¬Ø§Ø²</button>
        <button class="test-btn" onclick="testPrayerNotification()">ØªØ¬Ø±Ø¨Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØµÙ„Ø§Ø©</button>
        <button class="test-btn" onclick="testWisdomNotification()">ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø­ÙƒÙ…Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</button>
        <button class="test-btn" onclick="testStreakNotification()">ØªØ¬Ø±Ø¨Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…ØªØªØ§Ù„ÙŠ</button>
    </div>

    <!-- Statistics -->
    <div class="test-section">
        <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalScheduled">-</div>
                <div>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ø¬Ø¯ÙˆÙ„Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="enabledReminders">-</div>
                <div>ØªØ°ÙƒÙŠØ±Ø§Øª Ù…ÙØ¹Ù„Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalReminders">-</div>
                <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="permissionLevel">-</div>
                <div>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥Ø°Ù†</div>
            </div>
        </div>
        <button class="test-btn" onclick="refreshStats()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
    </div>

    <!-- Prayer Times -->
    <div class="test-section">
        <h3>ğŸ•Œ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©</h3>
        <div class="prayer-times-card">
            <div id="prayerTimesDisplay">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©...</div>
        </div>
        <button class="test-btn" onclick="refreshPrayerTimes()">ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©</button>
    </div>

    <!-- Notification Settings -->
    <div class="test-section">
        <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
        <div class="settings-grid" id="settingsGrid">
            <!-- Settings will be populated by JavaScript -->
        </div>
        <div style="margin-top: 20px;">
            <button class="test-btn" onclick="enableAllNotifications()">ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙ„</button>
            <button class="test-btn" onclick="disableAllNotifications()">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒÙ„</button>
        </div>
    </div>

    <!-- Notification Log -->
    <div class="test-section">
        <h3>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
        <div class="notification-log" id="notificationLog">
            Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù‡Ù†Ø§...
        </div>
        <button class="test-btn" onclick="clearLog()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
    </div>

    <!-- Advanced Controls -->
    <div class="test-section">
        <h3>ğŸ”§ ØªØ­ÙƒÙ… Ù…ØªÙ‚Ø¯Ù…</h3>
        <button class="test-btn" onclick="scheduleTestReminders()">Ø¬Ø¯ÙˆÙ„Ø© ØªØ°ÙƒÙŠØ±Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
        <button class="test-btn" onclick="clearAllScheduled()">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©</button>
        <button class="test-btn" onclick="exportSettings()">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <button class="test-btn" onclick="resetToDefaults()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</button>
    </div>
</div>

<script>
let notificationService;
let notificationLog = [];

// Initialize when page loads
document.addEventListener('DOMContentLoaded', async function() {
    if (window.islamicNotifications) {
        notificationService = window.islamicNotifications;
        updatePermissionStatus();
        refreshStats();
        loadNotificationSettings();
        refreshPrayerTimes();
        setupLogCapture();
    } else {
        logMessage('âš ï¸ Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
    }
});

function updatePermissionStatus() {
    const statusDiv = document.getElementById('permissionStatus');
    const permission = Notification.permission;
    
    let statusClass = 'status-card';
    let statusText = '';
    
    switch(permission) {
        case 'granted':
            statusClass += '';
            statusText = 'âœ… ØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª - ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª';
            break;
        case 'denied':
            statusClass += ' status-error';
            statusText = 'âŒ ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª - ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„Ù‡Ø§ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­';
            break;
        case 'default':
            statusClass += ' status-warning';
            statusText = 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¨Ø¹Ø¯ - Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª"';
            break;
    }
    
    statusDiv.className = statusClass;
    statusDiv.innerHTML = `<div class="permission-status">${statusText}</div>`;
}

async function requestPermission() {
    if (notificationService) {
        const granted = await notificationService.requestPermission();
        updatePermissionStatus();
        if (granted) {
            logMessage('âœ… ØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            await notificationService.init();
            refreshStats();
        } else {
            logMessage('âŒ ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª');
        }
    }
}

function testBasicNotification() {
    if (notificationService) {
        notificationService.testNotification();
        logMessage('ğŸ“± ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
    }
}

function testAchievementNotification() {
    if (notificationService) {
        notificationService.showAchievement(
            'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²',
            'Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª! ğŸ†'
        );
        logMessage('ğŸ† ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ù†Ø¬Ø§Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
    }
}

function testPrayerNotification() {
    if (notificationService) {
        notificationService.showNotification(
            'Ø­Ø§Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø±',
            'ÙˆÙ‚Øª ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø± ğŸ•Œ',
            { url: '/prayer_times' }
        );
        logMessage('ğŸ•Œ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ ØµÙ„Ø§Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
    }
}

function testWisdomNotification() {
    if (notificationService) {
        notificationService.showIslamicWisdom();
        logMessage('ğŸ’ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø­ÙƒÙ…Ø© Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
    }
}

function testStreakNotification() {
    if (notificationService) {
        notificationService.showStreakNotification(7);
        logMessage('ğŸ”¥ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ù†Ø¬Ø§Ø² Ù…ØªØªØ§Ù„ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
    }
}

function refreshStats() {
    if (notificationService) {
        const stats = notificationService.getNotificationStats();
        
        document.getElementById('totalScheduled').textContent = stats.totalScheduled;
        document.getElementById('enabledReminders').textContent = stats.remindersEnabled;
        document.getElementById('totalReminders').textContent = stats.totalReminders;
        document.getElementById('permissionLevel').textContent = stats.permissionStatus;
        
        logMessage(`ğŸ“Š ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${stats.remindersEnabled}/${stats.totalReminders} Ù…ÙØ¹Ù„`);
    }
}

async function refreshPrayerTimes() {
    if (notificationService) {
        try {
            const prayerTimes = await notificationService.getPrayerTimes();
            const display = document.getElementById('prayerTimesDisplay');
            
            if (prayerTimes) {
                const formatTime = (date) => {
                    return date.toLocaleTimeString('ar-SA', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: true 
                    });
                };
                
                display.innerHTML = `
                    <div class="prayer-time-item">
                        <span>ğŸŒ… Ø§Ù„ÙØ¬Ø±:</span>
                        <span>${formatTime(prayerTimes.fajr)}</span>
                    </div>
                    <div class="prayer-time-item">
                        <span>â˜€ï¸ Ø§Ù„Ø¸Ù‡Ø±:</span>
                        <span>${formatTime(prayerTimes.dhuhr)}</span>
                    </div>
                    <div class="prayer-time-item">
                        <span>ğŸŒ† Ø§Ù„Ø¹ØµØ±:</span>
                        <span>${formatTime(prayerTimes.asr)}</span>
                    </div>
                    <div class="prayer-time-item">
                        <span>ğŸŒ… Ø§Ù„Ù…ØºØ±Ø¨:</span>
                        <span>${formatTime(prayerTimes.maghrib)}</span>
                    </div>
                    <div class="prayer-time-item">
                        <span>ğŸŒ™ Ø§Ù„Ø¹Ø´Ø§Ø¡:</span>
                        <span>${formatTime(prayerTimes.isha)}</span>
                    </div>
                `;
                logMessage('ğŸ•Œ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                display.textContent = 'ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©';
                logMessage('âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©');
            }
        } catch (error) {
            logMessage(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©: ${error.message}`);
        }
    }
}

function loadNotificationSettings() {
    if (notificationService) {
        const settings = notificationService.getReminderSettings();
        const settingsGrid = document.getElementById('settingsGrid');
        
        const settingNames = {
            fajr: 'ğŸŒ… ØªÙ†Ø¨ÙŠÙ‡ ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø±',
            dhuhr: 'â˜€ï¸ ØªÙ†Ø¨ÙŠÙ‡ ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø±',
            asr: 'ğŸŒ† ØªÙ†Ø¨ÙŠÙ‡ ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ±',
            maghrib: 'ğŸŒ… ØªÙ†Ø¨ÙŠÙ‡ ØµÙ„Ø§Ø© Ø§Ù„Ù…ØºØ±Ø¨',
            isha: 'ğŸŒ™ ØªÙ†Ø¨ÙŠÙ‡ ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡',
            morning_azkar: 'ğŸŒ… ØªÙ†Ø¨ÙŠÙ‡ Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­',
            evening_azkar: 'ğŸŒ„ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡',
            sleep_azkar: 'ğŸŒ™ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…',
            daily_quran: 'ğŸ“– ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†',
            istighfar: 'ğŸ¤² ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø§Ø³ØªØºÙØ§Ø±'
        };
        
        settingsGrid.innerHTML = '';
        
        Object.entries(settings).forEach(([key, setting]) => {
            const settingCard = document.createElement('div');
            settingCard.className = 'setting-card';
            settingCard.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: bold;">${settingNames[key]}</div>
                        <div style="font-size: 12px; color: #666;">${setting.message}</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" ${setting.enabled ? 'checked' : ''} 
                               onchange="toggleReminder('${key}', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            `;
            settingsGrid.appendChild(settingCard);
        });
    }
}

function toggleReminder(reminderType, enabled) {
    if (notificationService) {
        notificationService.updateReminderSettings(reminderType, { enabled });
        logMessage(`${enabled ? 'âœ…' : 'âŒ'} ØªÙ… ${enabled ? 'ØªÙØ¹ÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù'} ØªÙ†Ø¨ÙŠÙ‡ ${reminderType}`);
        refreshStats();
    }
}

function enableAllNotifications() {
    if (notificationService) {
        notificationService.enableAllNotifications();
        loadNotificationSettings();
        refreshStats();
        logMessage('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª');
    }
}

function disableAllNotifications() {
    if (notificationService) {
        notificationService.disableAllNotifications();
        loadNotificationSettings();
        refreshStats();
        logMessage('âŒ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª');
    }
}

function scheduleTestReminders() {
    if (notificationService) {
        // Schedule a test reminder in 10 seconds
        setTimeout(() => {
            notificationService.showNotification(
                'ØªØ°ÙƒÙŠØ± ØªØ¬Ø±ÙŠØ¨ÙŠ',
                'Ù‡Ø°Ø§ ØªØ°ÙƒÙŠØ± ØªØ¬Ø±ÙŠØ¨ÙŠ ØªÙ… Ø¬Ø¯ÙˆÙ„ØªÙ‡ Ù…Ù†Ø° 10 Ø«ÙˆØ§Ù†Ù ğŸ•',
                { requireInteraction: true }
            );
        }, 10000);
        
        logMessage('â° ØªÙ… Ø¬Ø¯ÙˆÙ„Ø© ØªØ°ÙƒÙŠØ± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ø¸Ù‡ÙˆØ±Ù‡ Ø®Ù„Ø§Ù„ 10 Ø«ÙˆØ§Ù†Ù');
    }
}

function clearAllScheduled() {
    if (notificationService) {
        notificationService.scheduledNotifications.forEach(timeoutId => clearTimeout(timeoutId));
        notificationService.scheduledNotifications.clear();
        refreshStats();
        logMessage('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©');
    }
}

function exportSettings() {
    if (notificationService) {
        const settings = {
            reminders: notificationService.getReminderSettings(),
            stats: notificationService.getNotificationStats(),
            timestamp: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(settings, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = 'islamic-notifications-settings.json';
        link.click();
        
        logMessage('ğŸ’¾ ØªÙ… ØªØµØ¯ÙŠØ± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª');
    }
}

function resetToDefaults() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ')) {
        localStorage.removeItem('islamicReminders');
        localStorage.removeItem('islamicNotificationsInit');
        location.reload();
        logMessage('ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
    }
}

function setupLogCapture() {
    // Capture console messages related to notifications
    const originalLog = console.log;
    const originalWarn = console.warn;
    const originalError = console.error;
    
    console.log = function(...args) {
        originalLog.apply(console, args);
        if (args.some(arg => typeof arg === 'string' && (arg.includes('notification') || arg.includes('prayer')))) {
            logMessage(`ğŸ“ ${args.join(' ')}`);
        }
    };
}

function logMessage(message) {
    const timestamp = new Date().toLocaleTimeString('ar-SA');
    notificationLog.unshift(`[${timestamp}] ${message}`);
    
    // Keep only last 50 messages
    if (notificationLog.length > 50) {
        notificationLog = notificationLog.slice(0, 50);
    }
    
    updateLogDisplay();
}

function updateLogDisplay() {
    const logDiv = document.getElementById('notificationLog');
    logDiv.innerHTML = notificationLog.map(entry => 
        `<div class="log-entry">${entry}</div>`
    ).join('');
}

function clearLog() {
    notificationLog = [];
    updateLogDisplay();
}
</script>
{% endblock %}
