{% extends "base.html" %}

{% block title %}Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ØµÙˆØ§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª{% endblock %}

{% block styles %}
<style>
    .test-container {
        max-width: 1000px;
        margin: 2rem auto;
        padding: 2rem;
    }

    .test-header {
        text-align: center;
        margin-bottom: 3rem;
        background: var(--card-bg);
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .test-header h1 {
        color: var(--primary-color);
        font-size: 2.5rem;
        margin-bottom: 1rem;
    }

    .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .test-section {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--border-color);
    }

    .section-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .test-button {
        width: 100%;
        padding: 1rem;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        margin-bottom: 0.8rem;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .test-button:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .test-button:active {
        transform: translateY(0);
    }

    .test-button.success {
        background: var(--success-color);
    }

    .test-button.warning {
        background: var(--warning-color);
    }

    .test-button.danger {
        background: var(--error-color);
    }

    .status-display {
        background: var(--bg-color);
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        border: 1px solid var(--border-color);
    }

    .status-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .status-item:last-child {
        border-bottom: none;
    }

    .status-label {
        font-weight: 500;
    }

    .status-value {
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.9rem;
    }

    .status-enabled {
        background: rgba(34, 197, 94, 0.1);
        color: #22c55e;
    }

    .status-disabled {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
    }

    .status-unknown {
        background: rgba(156, 163, 175, 0.1);
        color: #9ca3af;
    }

    .control-panel {
        background: var(--card-bg);
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .control-group {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
    }

    .volume-control {
        display: flex;
        align-items: center;
        gap: 1rem;
        background: var(--bg-color);
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
    }

    .volume-slider {
        flex: 1;
        height: 6px;
        border-radius: 3px;
        background: var(--border-color);
        outline: none;
        -webkit-appearance: none;
    }

    .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        background: var(--primary-color);
        border-radius: 50%;
        cursor: pointer;
    }

    .test-log {
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        max-height: 200px;
        overflow-y: auto;
        margin-top: 1rem;
        font-family: monospace;
        font-size: 0.9rem;
        direction: ltr;
        text-align: left;
    }

    .log-entry {
        padding: 0.25rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .log-entry:last-child {
        border-bottom: none;
    }

    .log-time {
        color: var(--text-muted);
        font-size: 0.8rem;
    }

    .emergency-controls {
        background: #fee2e2;
        border: 1px solid #fca5a5;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 2rem;
    }

    .emergency-controls h3 {
        color: #dc2626;
        margin-bottom: 1rem;
    }

    .emergency-button {
        background: #dc2626;
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 6px;
        cursor: pointer;
        margin-right: 1rem;
        margin-bottom: 0.5rem;
    }

    @media (max-width: 768px) {
        .test-grid {
            grid-template-columns: 1fr;
        }
        
        .control-group {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="test-container">
    <div class="test-header">
        <h1>ğŸµ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ØµÙˆØ§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h1>
        <p>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø£ØµÙˆØ§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ</p>
    </div>

    <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
    <div class="control-panel">
        <h2 class="section-title">
            <i class="fas fa-info-circle"></i>
            Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        </h2>
        <div class="status-display">
            <div class="status-item">
                <span class="status-label">Ø¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:</span>
                <span class="status-value" id="notificationSupport">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:</span>
                <span class="status-value" id="notificationPermission">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Ø¯Ø¹Ù… Ø§Ù„ØµÙˆØª:</span>
                <span class="status-value" id="audioSupport">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Ø¯Ø¹Ù… Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²:</span>
                <span class="status-value" id="vibrationSupport">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª:</span>
                <span class="status-value" id="audioManagerStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>
            </div>
        </div>

        <!-- ØªØ­ÙƒÙ… ÙÙŠ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª -->
        <div class="volume-control">
            <i class="fas fa-volume-down"></i>
            <input type="range" class="volume-slider" id="testVolumeSlider" min="0" max="100" value="70">
            <i class="fas fa-volume-up"></i>
            <span id="volumeDisplay">70%</span>
        </div>
    </div>

    <!-- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£ØµÙˆØ§Øª -->
    <div class="test-grid">
        <!-- Ø£ØµÙˆØ§Øª Ø§Ù„ØµÙ„Ø§Ø© -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fas fa-mosque"></i>
                Ø£ØµÙˆØ§Øª Ø§Ù„ØµÙ„Ø§Ø©
            </h2>
            <button class="test-button" onclick="testPrayerSound('fajr')">
                <i class="fas fa-sun"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø°Ø§Ù† Ø§Ù„ÙØ¬Ø±
            </button>
            <button class="test-button" onclick="testPrayerSound('dhuhr')">
                <i class="fas fa-mosque"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø°Ø§Ù† Ø§Ù„Ø¸Ù‡Ø±
            </button>
            <button class="test-button" onclick="testPrayerSound('asr')">
                <i class="fas fa-cloud-sun"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø°Ø§Ù† Ø§Ù„Ø¹ØµØ±
            </button>
            <button class="test-button" onclick="testPrayerSound('maghrib')">
                <i class="fas fa-sunset"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø°Ø§Ù† Ø§Ù„Ù…ØºØ±Ø¨
            </button>
            <button class="test-button" onclick="testPrayerSound('isha')">
                <i class="fas fa-moon"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø°Ø§Ù† Ø§Ù„Ø¹Ø´Ø§Ø¡
            </button>
        </div>

        <!-- Ø£ØµÙˆØ§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø± -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fas fa-hands-praying"></i>
                Ø£ØµÙˆØ§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø±
            </h2>
            <button class="test-button" onclick="testAzkarSound('morning')">
                <i class="fas fa-sunrise"></i>
                Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­
            </button>
            <button class="test-button" onclick="testAzkarSound('evening')">
                <i class="fas fa-mountain-sun"></i>
                Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡
            </button>
            <button class="test-button" onclick="testAzkarSound('sleep')">
                <i class="fas fa-bed"></i>
                Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…
            </button>
            <button class="test-button" onclick="testAzkarSound('general')">
                <i class="fas fa-hand-holding-heart"></i>
                Ø£Ø°ÙƒØ§Ø± Ø¹Ø§Ù…Ø©
            </button>
        </div>

        <!-- Ø£ØµÙˆØ§Øª Ø£Ø®Ø±Ù‰ -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fas fa-music"></i>
                Ø£ØµÙˆØ§Øª Ø£Ø®Ø±Ù‰
            </h2>
            <button class="test-button" onclick="testQuranSound()">
                <i class="fas fa-book-quran"></i>
                ØªØ°ÙƒÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù†
            </button>
            <button class="test-button" onclick="testTasbihSound()">
                <i class="fas fa-pray"></i>
                ØµÙˆØª Ø§Ù„ØªØ³Ø¨ÙŠØ­
            </button>
            <button class="test-button" onclick="testGeneralNotification()">
                <i class="fas fa-bell"></i>
                Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ù…
            </button>
            <button class="test-button" onclick="testVibration()">
                <i class="fas fa-mobile-alt"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²
            </button>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
        <div class="test-section">
            <h2 class="section-title">
                <i class="fas fa-bell"></i>
                Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            </h2>
            <button class="test-button" onclick="testNotificationWithSound('prayer', 'fajr')">
                <i class="fas fa-mosque"></i>
                Ø¥Ø´Ø¹Ø§Ø± ØµÙ„Ø§Ø© + ØµÙˆØª
            </button>
            <button class="test-button" onclick="testNotificationWithSound('azkar', 'morning')">
                <i class="fas fa-hands-praying"></i>
                Ø¥Ø´Ø¹Ø§Ø± Ø£Ø°ÙƒØ§Ø± + ØµÙˆØª
            </button>
            <button class="test-button" onclick="testNotificationWithSound('quran')">
                <i class="fas fa-book-quran"></i>
                Ø¥Ø´Ø¹Ø§Ø± Ù‚Ø±Ø¢Ù† + ØµÙˆØª
            </button>
            <button class="test-button" onclick="requestNotificationPermission()">
                <i class="fas fa-key"></i>
                Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            </button>
        </div>
    </div>

    <!-- Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø¬Ù…Ø¹Ø© -->
    <div class="control-panel">
        <h2 class="section-title">
            <i class="fas fa-layer-group"></i>
            Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø¬Ù…Ø¹Ø©
        </h2>
        <div class="control-group">
            <button class="test-button success" onclick="testAllPrayerSounds()">
                <i class="fas fa-play-circle"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø£ØµÙˆØ§Øª Ø§Ù„ØµÙ„Ø§Ø©
            </button>
            <button class="test-button success" onclick="testAllAzkarSounds()">
                <i class="fas fa-play-circle"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø£ØµÙˆØ§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø±
            </button>
            <button class="test-button warning" onclick="generateDemoSounds()">
                <i class="fas fa-magic"></i>
                Ø¥Ù†Ø´Ø§Ø¡ Ø£ØµÙˆØ§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            </button>
            <button class="test-button warning" onclick="resetAudioSettings()">
                <i class="fas fa-undo"></i>
                Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
        </div>
    </div>

    <!-- Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª -->
    <div class="control-panel">
        <h2 class="section-title">
            <i class="fas fa-list"></i>
            Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        </h2>
        <div class="test-log" id="testLog">
            <div class="log-entry">
                <span class="log-time">[Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...]</span>
                Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ØµÙˆØ§Øª
            </div>
        </div>
        <button class="test-button warning" onclick="clearTestLog()">
            <i class="fas fa-trash"></i>
            Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
        </button>
    </div>

    <!-- Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ… Ø·ÙˆØ§Ø±Ø¦ -->
    <div class="emergency-controls">
        <h3>ğŸš¨ Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</h3>
        <p>Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„ØµÙˆØª</p>
        <button class="emergency-button" onclick="stopAllSounds()">
            <i class="fas fa-stop"></i>
            Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª
        </button>
        <button class="emergency-button" onclick="disableAllAudio()">
            <i class="fas fa-volume-mute"></i>
            ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØµÙˆØª ØªÙ…Ø§Ù…Ø§Ù‹
        </button>
        <button class="emergency-button" onclick="resetAudioSystem()">
            <i class="fas fa-power-off"></i>
            Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª
        </button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeTestPage();
    checkSystemStatus();
    setupVolumeControl();
});

function initializeTestPage() {
    log('ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ØµÙˆØ§Øª');
    log('Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…...');
}

function checkSystemStatus() {
    // ÙØ­Øµ Ø¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    const notificationSupport = 'Notification' in window;
    updateStatus('notificationSupport', notificationSupport ? 'Ù…Ø¯Ø¹ÙˆÙ…' : 'ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…', notificationSupport);

    // ÙØ­Øµ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    if (notificationSupport) {
        const permission = Notification.permission;
        updateStatus('notificationPermission', permission === 'granted' ? 'Ù…ÙØ¹Ù„' : permission === 'denied' ? 'Ù…Ø±ÙÙˆØ¶' : 'Ù„Ù… ÙŠÙØ·Ù„Ø¨', permission === 'granted');
    } else {
        updateStatus('notificationPermission', 'ØºÙŠØ± Ù…ØªØ§Ø­', false);
    }

    // ÙØ­Øµ Ø¯Ø¹Ù… Ø§Ù„ØµÙˆØª
    const audioSupport = 'Audio' in window;
    updateStatus('audioSupport', audioSupport ? 'Ù…Ø¯Ø¹ÙˆÙ…' : 'ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…', audioSupport);

    // ÙØ­Øµ Ø¯Ø¹Ù… Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²
    const vibrationSupport = 'vibrate' in navigator;
    updateStatus('vibrationSupport', vibrationSupport ? 'Ù…Ø¯Ø¹ÙˆÙ…' : 'ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…', vibrationSupport);

    // ÙØ­Øµ Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª
    const audioManagerAvailable = typeof window.audioManager !== 'undefined';
    updateStatus('audioManagerStatus', audioManagerAvailable ? 'Ù…ØªØ§Ø­' : 'ØºÙŠØ± Ù…ØªØ§Ø­', audioManagerAvailable);

    if (audioManagerAvailable) {
        log('Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª Ù…ØªØ§Ø­ ÙˆÙ…ÙØ¹Ù„ âœ…');
    } else {
        log('ØªØ­Ø°ÙŠØ±: Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…ØªØ§Ø­ âš ï¸');
    }
}

function updateStatus(elementId, text, isGood) {
    const element = document.getElementById(elementId);
    if (element) {
        element.textContent = text;
        element.className = `status-value ${isGood ? 'status-enabled' : 'status-disabled'}`;
    }
}

function setupVolumeControl() {
    const slider = document.getElementById('testVolumeSlider');
    const display = document.getElementById('volumeDisplay');
    
    slider.addEventListener('input', function() {
        const volume = this.value;
        display.textContent = volume + '%';
        
        if (window.audioManager) {
            window.audioManager.updateSettings({ volume: volume / 100 });
            log(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ ${volume}%`);
        }
    });
}

function log(message) {
    const logElement = document.getElementById('testLog');
    const time = new Date().toLocaleTimeString();
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
    logElement.appendChild(entry);
    logElement.scrollTop = logElement.scrollHeight;
}

async function testPrayerSound(prayer) {
    log(`Ø§Ø®ØªØ¨Ø§Ø± ØµÙˆØª ØµÙ„Ø§Ø© ${prayer}...`);
    try {
        if (window.audioManager) {
            await window.audioManager.testPrayerSound(prayer);
            log(`âœ… ØªÙ… ØªØ´ØºÙŠÙ„ ØµÙˆØª ØµÙ„Ø§Ø© ${prayer} Ø¨Ù†Ø¬Ø§Ø­`);
        } else {
            throw new Error('Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…ØªØ§Ø­');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØª ØµÙ„Ø§Ø© ${prayer}: ${error.message}`);
    }
}

async function testAzkarSound(type) {
    log(`Ø§Ø®ØªØ¨Ø§Ø± ØµÙˆØª Ø£Ø°ÙƒØ§Ø± ${type}...`);
    try {
        if (window.audioManager) {
            await window.audioManager.testAzkarSound(type);
            log(`âœ… ØªÙ… ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø£Ø°ÙƒØ§Ø± ${type} Ø¨Ù†Ø¬Ø§Ø­`);
        } else {
            throw new Error('Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…ØªØ§Ø­');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø£Ø°ÙƒØ§Ø± ${type}: ${error.message}`);
    }
}

async function testQuranSound() {
    log('Ø§Ø®ØªØ¨Ø§Ø± ØµÙˆØª ØªØ°ÙƒÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù†...');
    try {
        if (window.audioManager) {
            await window.audioManager.playQuranSound();
            log('âœ… ØªÙ… ØªØ´ØºÙŠÙ„ ØµÙˆØª ØªØ°ÙƒÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨Ù†Ø¬Ø§Ø­');
        } else {
            throw new Error('Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…ØªØ§Ø­');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØª ØªØ°ÙƒÙŠØ± Ø§Ù„Ù‚Ø±Ø¢Ù†: ${error.message}`);
    }
}

async function testTasbihSound() {
    log('Ø§Ø®ØªØ¨Ø§Ø± ØµÙˆØª Ø§Ù„ØªØ³Ø¨ÙŠØ­...');
    try {
        if (window.audioManager) {
            await window.audioManager.playTasbehSound();
            log('âœ… ØªÙ… ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ØªØ³Ø¨ÙŠØ­ Ø¨Ù†Ø¬Ø§Ø­');
        } else {
            throw new Error('Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…ØªØ§Ø­');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ØªØ³Ø¨ÙŠØ­: ${error.message}`);
    }
}

async function testGeneralNotification() {
    log('Ø§Ø®ØªØ¨Ø§Ø± ØµÙˆØª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ø§Ù…...');
    try {
        if (window.audioManager) {
            await window.audioManager.playGeneralNotification();
            log('âœ… ØªÙ… ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
        } else {
            throw new Error('Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…ØªØ§Ø­');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ø§Ù…: ${error.message}`);
    }
}

function testVibration() {
    log('Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²...');
    try {
        if ('vibrate' in navigator) {
            navigator.vibrate([200, 100, 200, 100, 200]);
            log('âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­');
        } else {
            throw new Error('Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²: ${error.message}`);
    }
}

async function testNotificationWithSound(type, subType) {
    log(`Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± ${type} Ù…Ø¹ ØµÙˆØª...`);
    try {
        if (window.islamicNotifications) {
            let title, message, options;
            
            switch(type) {
                case 'prayer':
                    title = `Ø­Ø§Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© ${subType}`;
                    message = 'Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØµÙ„Ø§Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØª';
                    options = { type: 'prayer', subType: subType };
                    break;
                case 'azkar':
                    title = `ØªØ°ÙƒÙŠØ± ${subType}`;
                    message = 'Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ù…Ø¹ Ø§Ù„ØµÙˆØª';
                    options = { type: 'azkar', subType: subType };
                    break;
                case 'quran':
                    title = 'ØªØ°ÙƒÙŠØ± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†';
                    message = 'Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù‚Ø±Ø¢Ù† Ù…Ø¹ Ø§Ù„ØµÙˆØª';
                    options = { type: 'quran' };
                    break;
            }
            
            window.islamicNotifications.showNotification(title, message, options);
            log(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ${type} Ù…Ø¹ Ø§Ù„ØµÙˆØª Ø¨Ù†Ø¬Ø§Ø­`);
        } else {
            throw new Error('Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø©');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ${type}: ${error.message}`);
    }
}

async function requestNotificationPermission() {
    log('Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...');
    try {
        if ('Notification' in window) {
            const permission = await Notification.requestPermission();
            updateStatus('notificationPermission', permission === 'granted' ? 'Ù…ÙØ¹Ù„' : permission === 'denied' ? 'Ù…Ø±ÙÙˆØ¶' : 'Ù„Ù… ÙŠÙØ·Ù„Ø¨', permission === 'granted');
            log(`âœ… Ø­Ø§Ù„Ø© Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ${permission}`);
        } else {
            throw new Error('Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: ${error.message}`);
    }
}

async function testAllPrayerSounds() {
    log('Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø£ØµÙˆØ§Øª Ø§Ù„ØµÙ„Ø§Ø©...');
    const prayers = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
    
    for (const prayer of prayers) {
        await testPrayerSound(prayer);
        await new Promise(resolve => setTimeout(resolve, 2000)); // Ø§Ù†ØªØ¸Ø§Ø± Ø«Ø§Ù†ÙŠØªÙŠÙ† Ø¨ÙŠÙ† ÙƒÙ„ ØµÙˆØª
    }
    
    log('âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø£ØµÙˆØ§Øª Ø§Ù„ØµÙ„Ø§Ø©');
}

async function testAllAzkarSounds() {
    log('Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø£ØµÙˆØ§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø±...');
    const azkarTypes = ['morning', 'evening', 'sleep', 'general'];
    
    for (const type of azkarTypes) {
        await testAzkarSound(type);
        await new Promise(resolve => setTimeout(resolve, 1500)); // Ø§Ù†ØªØ¸Ø§Ø± Ø«Ø§Ù†ÙŠØ© ÙˆÙ†ØµÙ Ø¨ÙŠÙ† ÙƒÙ„ ØµÙˆØª
    }
    
    log('âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø£ØµÙˆØ§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø±');
}

async function generateDemoSounds() {
    log('Ø¨Ø¯Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');
    try {
        if (window.audioGenerator) {
            await generateAllDemoSounds();
            log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
        } else {
            throw new Error('Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø£ØµÙˆØ§Øª ØºÙŠØ± Ù…ØªØ§Ø­');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©: ${error.message}`);
    }
}

function resetAudioSettings() {
    log('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª...');
    try {
        if (window.audioManager) {
            window.audioManager.updateSettings({
                enabled: true,
                volume: 0.7,
                muteAt: { start: '23:00', end: '06:00' },
                useVibration: true
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ±
            document.getElementById('testVolumeSlider').value = 70;
            document.getElementById('volumeDisplay').textContent = '70%';
            
            log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ø¨Ù†Ø¬Ø§Ø­');
        } else {
            throw new Error('Ù…Ø¯ÙŠØ± Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…ØªØ§Ø­');
        }
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª: ${error.message}`);
    }
}

function clearTestLog() {
    const logElement = document.getElementById('testLog');
    logElement.innerHTML = '<div class="log-entry"><span class="log-time">[ØªÙ… Ø§Ù„Ù…Ø³Ø­]</span> ØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</div>';
    log('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ ÙˆØ¨Ø¯Ø¡ Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯');
}

function stopAllSounds() {
    log('ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª...');
    try {
        // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙˆØª
        const audioElements = document.querySelectorAll('audio');
        audioElements.forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
        });
        
        // Ø¥ÙŠÙ‚Ø§Ù AudioContext
        if (window.audioManager && window.audioManager.audioContext) {
            window.audioManager.audioContext.suspend();
        }
        
        log('âœ… ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª');
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£ØµÙˆØ§Øª: ${error.message}`);
    }
}

function disableAllAudio() {
    log('ğŸ”‡ ØªØ¹Ø·ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª...');
    try {
        if (window.audioManager) {
            window.audioManager.updateSettings({ enabled: false });
        }
        
        updateStatus('audioManagerStatus', 'Ù…Ø¹Ø·Ù„', false);
        log('âœ… ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª');
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØµÙˆØª: ${error.message}`);
    }
}

function resetAudioSystem() {
    log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª...');
    try {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØµÙˆØª
        if (window.audioManager) {
            window.audioManager.updateSettings({ enabled: true });
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…
        setTimeout(() => {
            checkSystemStatus();
            log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª');
        }, 1000);
        
    } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª: ${error.message}`);
    }
}
</script>
{% endblock %}
