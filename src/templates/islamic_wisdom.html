{% extends "base.html" %}

{% block title %}الحكم والأقوال الإسلامية{% endblock %}

{% block extra_css %}
<style>
    .wisdom-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        direction: rtl;
    }

    .wisdom-header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }

    .wisdom-header h1 {
        margin: 0 0 15px 0;
        font-size: 2.5em;
    }

    .wisdom-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 25px;
        margin: 30px 0;
    }

    .wisdom-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        border-right: 5px solid #667eea;
        position: relative;
        overflow: hidden;
    }

    .wisdom-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }

    .wisdom-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), transparent);
        border-radius: 0 0 0 100px;
    }

    .wisdom-text {
        font-size: 1.2em;
        line-height: 1.8;
        color: #333;
        margin-bottom: 15px;
        font-weight: 500;
        position: relative;
        z-index: 2;
    }

    .wisdom-source {
        color: #667eea;
        font-weight: bold;
        font-size: 0.9em;
        border-top: 1px solid #eee;
        padding-top: 15px;
        position: relative;
        z-index: 2;
    }

    .wisdom-category {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.8em;
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 3;
    }

    .daily-wisdom {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        color: #333;
        padding: 30px;
        border-radius: 20px;
        margin: 30px 0;
        text-align: center;
        border: 3px solid #f39c12;
    }

    .daily-wisdom h3 {
        color: #d68910;
        margin-bottom: 20px;
        font-size: 1.5em;
    }

    .daily-wisdom-text {
        font-size: 1.3em;
        line-height: 1.8;
        margin-bottom: 15px;
        font-weight: 600;
    }

    .filter-tabs {
        display: flex;
        justify-content: center;
        margin: 30px 0;
        flex-wrap: wrap;
        gap: 10px;
    }

    .filter-tab {
        background: #f8f9fa;
        border: 2px solid #667eea;
        color: #667eea;
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .filter-tab.active {
        background: #667eea;
        color: white;
    }

    .filter-tab:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
    }

    .action-buttons {
        text-align: center;
        margin: 30px 0;
    }

    .action-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        cursor: pointer;
        margin: 10px;
        font-size: 1em;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .action-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .search-bar {
        max-width: 500px;
        margin: 20px auto;
        position: relative;
    }

    .search-input {
        width: 100%;
        padding: 15px 50px 15px 20px;
        border: 2px solid #667eea;
        border-radius: 25px;
        font-size: 1em;
        direction: rtl;
    }

    .search-btn {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: #667eea;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 50%;
        cursor: pointer;
    }

    .wisdom-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 10px;
    }

    .stat-label {
        color: #666;
    }

    .share-card {
        position: relative;
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        margin: 10px 0;
    }

    .share-btns {
        position: absolute;
        top: 15px;
        left: 15px;
        display: flex;
        gap: 5px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .wisdom-card:hover .share-btns {
        opacity: 1;
    }

    .share-btn {
        background: rgba(255,255,255,0.9);
        border: none;
        padding: 8px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s ease;
    }

    .share-btn:hover {
        background: white;
        transform: scale(1.1);
    }

    @media (max-width: 768px) {
        .wisdom-grid {
            grid-template-columns: 1fr;
        }
        
        .filter-tabs {
            overflow-x: auto;
            justify-content: flex-start;
            padding: 0 20px;
        }
        
        .wisdom-header h1 {
            font-size: 2em;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="wisdom-container">
    <div class="wisdom-header">
        <h1>💝 الحكم والأقوال الإسلامية</h1>
        <p>مجموعة مختارة من الحكم والأقوال الإسلامية المؤثرة من القرآن والسنة النبوية</p>
    </div>

    <!-- Daily Wisdom -->
    <div class="daily-wisdom">
        <h3>🌟 حكمة اليوم</h3>
        <div class="daily-wisdom-text" id="dailyWisdomText">
            وَاذْكُرُوا اللَّهَ كَثِيرًا لَّعَلَّكُمْ تُفْلِحُونَ
        </div>
        <div class="wisdom-source">القرآن الكريم - الأنفال: 45</div>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
        <input type="text" class="search-input" placeholder="ابحث في الحكم والأقوال..." id="searchInput">
        <button class="search-btn" onclick="searchWisdom()">
            <i class="fas fa-search"></i>
        </button>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-tabs">
        <div class="filter-tab active" data-category="all" onclick="filterWisdom('all')">الكل</div>
        <div class="filter-tab" data-category="quran" onclick="filterWisdom('quran')">القرآن الكريم</div>
        <div class="filter-tab" data-category="hadith" onclick="filterWisdom('hadith')">الأحاديث النبوية</div>
        <div class="filter-tab" data-category="scholars" onclick="filterWisdom('scholars')">أقوال العلماء</div>
        <div class="filter-tab" data-category="supplications" onclick="filterWisdom('supplications')">الأدعية</div>
        <div class="filter-tab" data-category="motivational" onclick="filterWisdom('motivational')">تحفيزية</div>
    </div>

    <!-- Statistics -->
    <div class="wisdom-stats">
        <div class="stat-card">
            <div class="stat-number" id="totalWisdom">150+</div>
            <div class="stat-label">إجمالي الحكم</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="todayViews">0</div>
            <div class="stat-label">المشاهدات اليوم</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="favoriteCount">0</div>
            <div class="stat-label">المفضلة</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="sharedCount">0</div>
            <div class="stat-label">تم مشاركتها</div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <button class="action-btn" onclick="showRandomWisdom()">
            <i class="fas fa-random"></i> حكمة عشوائية
        </button>
        <button class="action-btn" onclick="toggleFavorites()">
            <i class="fas fa-heart"></i> المفضلة
        </button>
        <button class="action-btn" onclick="enableNotifications()">
            <i class="fas fa-bell"></i> تنبيهات يومية
        </button>
        <button class="action-btn" onclick="exportWisdom()">
            <i class="fas fa-download"></i> تصدير
        </button>
    </div>

    <!-- Wisdom Cards -->
    <div class="wisdom-grid" id="wisdomGrid">
        <!-- Cards will be populated by JavaScript -->
    </div>
</div>

<script>
// Islamic wisdom data
const wisdomData = [
    // Quran Verses
    {
        id: 1,
        text: "وَمَنْ يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا",
        source: "القرآن الكريم - الطلاق: 2",
        category: "quran",
        tags: ["تقوى", "فرج", "مخرج"]
    },
    {
        id: 2,
        text: "وَاصْبِرْ وَمَا صَبْرُكَ إِلَّا بِاللَّهِ",
        source: "القرآن الكريم - النحل: 127",
        category: "quran",
        tags: ["صبر", "قوة", "تحمل"]
    },
    {
        id: 3,
        text: "إِنَّ مَعَ الْعُسْرِ يُسْرًا",
        source: "القرآن الكريم - الشرح: 6",
        category: "quran",
        tags: ["أمل", "تفاؤل", "فرج"]
    },
    {
        id: 4,
        text: "وَهُوَ مَعَكُمْ أَيْنَ مَا كُنتُمْ",
        source: "القرآن الكريم - الحديد: 4",
        category: "quran",
        tags: ["معية", "قرب", "طمأنينة"]
    },
    {
        id: 5,
        text: "فَاذْكُرُونِي أَذْكُرْكُمْ وَاشْكُرُوا لِي وَلَا تَكْفُرُونِ",
        source: "القرآن الكريم - البقرة: 152",
        category: "quran",
        tags: ["ذكر", "شكر", "ذكر الله"]
    },

    // Hadith
    {
        id: 6,
        text: "إنما الأعمال بالنيات",
        source: "صحيح البخاري",
        category: "hadith",
        tags: ["نية", "إخلاص", "أعمال"]
    },
    {
        id: 7,
        text: "المؤمن للمؤمن كالبنيان يشد بعضه بعضاً",
        source: "صحيح البخاري",
        category: "hadith",
        tags: ["أخوة", "تعاون", "وحدة"]
    },
    {
        id: 8,
        text: "من لم يشكر الناس لم يشكر الله",
        source: "سنن أبي داود",
        category: "hadith",
        tags: ["شكر", "امتنان", "أدب"]
    },
    {
        id: 9,
        text: "الدنيا ساعة فاجعلها طاعة",
        source: "حديث شريف",
        category: "hadith",
        tags: ["دنيا", "طاعة", "حكمة"]
    },
    {
        id: 10,
        text: "خير الناس أنفعهم للناس",
        source: "حديث شريف",
        category: "hadith",
        tags: ["نفع", "خير", "خدمة"]
    },

    // Scholars' Sayings
    {
        id: 11,
        text: "إذا لم تستطع أن تنفع الناس بمالك فانفعهم بأخلاقك",
        source: "الإمام الشافعي",
        category: "scholars",
        tags: ["أخلاق", "نفع", "سلوك"]
    },
    {
        id: 12,
        text: "العلم في الصغر كالنقش على الحجر",
        source: "حكمة عربية",
        category: "scholars",
        tags: ["علم", "تعلم", "صغر"]
    },
    {
        id: 13,
        text: "من طلب العلا سهر الليالي",
        source: "حكمة عربية",
        category: "scholars",
        tags: ["طموح", "علا", "اجتهاد"]
    },
    {
        id: 14,
        text: "الصبر مفتاح الفرج",
        source: "حكمة إسلامية",
        category: "scholars",
        tags: ["صبر", "فرج", "مفتاح"]
    },
    {
        id: 15,
        text: "احرص على ما ينفعك واستعن بالله",
        source: "الإمام النووي",
        category: "scholars",
        tags: ["حرص", "نفع", "استعانة"]
    },

    // Supplications
    {
        id: 16,
        text: "رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ",
        source: "دعاء من القرآن - البقرة: 201",
        category: "supplications",
        tags: ["دعاء", "حسنة", "آخرة"]
    },
    {
        id: 17,
        text: "رَبِّ اشْرَحْ لِي صَدْرِي وَيَسِّرْ لِي أَمْرِي",
        source: "دعاء موسى عليه السلام - طه: 25-26",
        category: "supplications",
        tags: ["شرح صدر", "تيسير", "دعاء"]
    },
    {
        id: 18,
        text: "اللهم أعني على ذكرك وشكرك وحسن عبادتك",
        source: "دعاء نبوي",
        category: "supplications",
        tags: ["ذكر", "شكر", "عبادة"]
    },

    // Motivational
    {
        id: 19,
        text: "لا تيأس، فالله مع الصابرين",
        source: "حكمة إسلامية",
        category: "motivational",
        tags: ["أمل", "صبر", "تحفيز"]
    },
    {
        id: 20,
        text: "كل عمل ابن آدم له إلا الصوم فإنه لي وأنا أجزي به",
        source: "حديث قدسي",
        category: "motivational",
        tags: ["صوم", "جزاء", "عبادة"]
    }
];

let currentFilter = 'all';
let favorites = JSON.parse(localStorage.getItem('wisdomFavorites')) || [];
let showingFavorites = false;
let viewedToday = JSON.parse(localStorage.getItem('wisdomViewedToday')) || 0;

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    displayWisdom();
    updateStats();
    setDailyWisdom();
    
    // Setup search
    document.getElementById('searchInput').addEventListener('input', searchWisdom);
});

function displayWisdom(data = wisdomData) {
    const grid = document.getElementById('wisdomGrid');
    const filteredData = showingFavorites 
        ? data.filter(item => favorites.includes(item.id))
        : data;
    
    if (filteredData.length === 0) {
        grid.innerHTML = `
            <div style="text-align: center; grid-column: 1 / -1; padding: 40px;">
                <i class="fas fa-search" style="font-size: 3em; color: #ccc; margin-bottom: 20px;"></i>
                <p style="color: #666; font-size: 1.2em;">
                    ${showingFavorites ? 'لا توجد حكم مفضلة بعد' : 'لم يتم العثور على نتائج'}
                </p>
            </div>
        `;
        return;
    }
    
    grid.innerHTML = filteredData.map(wisdom => `
        <div class="wisdom-card ${favorites.includes(wisdom.id) ? 'share-card' : ''}" data-category="${wisdom.category}">
            <div class="wisdom-category">${getCategoryName(wisdom.category)}</div>
            <div class="share-btns">
                <button class="share-btn" onclick="shareWisdom(${wisdom.id})" title="مشاركة">
                    <i class="fas fa-share"></i>
                </button>
                <button class="share-btn" onclick="copyWisdom(${wisdom.id})" title="نسخ">
                    <i class="fas fa-copy"></i>
                </button>
                <button class="share-btn ${favorites.includes(wisdom.id) ? 'active' : ''}" 
                        onclick="toggleFavorite(${wisdom.id})" title="مفضلة">
                    <i class="fas fa-heart" style="color: ${favorites.includes(wisdom.id) ? '#e74c3c' : '#ccc'}"></i>
                </button>
            </div>
            <div class="wisdom-text">${wisdom.text}</div>
            <div class="wisdom-source">${wisdom.source}</div>
        </div>
    `).join('');
}

function filterWisdom(category) {
    currentFilter = category;
    
    // Update active tab
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector(`[data-category="${category}"]`).classList.add('active');
    
    // Filter data
    const filteredData = category === 'all' 
        ? wisdomData 
        : wisdomData.filter(item => item.category === category);
    
    displayWisdom(filteredData);
}

function searchWisdom() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    
    if (!searchTerm) {
        filterWisdom(currentFilter);
        return;
    }
    
    const searchResults = wisdomData.filter(wisdom => 
        wisdom.text.toLowerCase().includes(searchTerm) ||
        wisdom.source.toLowerCase().includes(searchTerm) ||
        wisdom.tags.some(tag => tag.includes(searchTerm))
    );
    
    displayWisdom(searchResults);
}

function getCategoryName(category) {
    const names = {
        'quran': 'قرآن',
        'hadith': 'حديث',
        'scholars': 'علماء',
        'supplications': 'دعاء',
        'motivational': 'تحفيز'
    };
    return names[category] || category;
}

function showRandomWisdom() {
    const randomWisdom = wisdomData[Math.floor(Math.random() * wisdomData.length)];
    
    // Create modal or highlight the wisdom
    const modal = document.createElement('div');
    modal.innerHTML = `
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.8); z-index: 1000; display: flex; 
                    align-items: center; justify-content: center; direction: rtl;">
            <div style="background: white; padding: 40px; border-radius: 20px; 
                        max-width: 600px; margin: 20px; text-align: center;">
                <div style="font-size: 1.5em; margin-bottom: 20px; line-height: 1.8;">
                    ${randomWisdom.text}
                </div>
                <div style="color: #667eea; font-weight: bold; margin-bottom: 30px;">
                    ${randomWisdom.source}
                </div>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="background: #667eea; color: white; border: none; 
                               padding: 12px 25px; border-radius: 25px; cursor: pointer;">
                    إغلاق
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    
    // Increment views
    viewedToday++;
    localStorage.setItem('wisdomViewedToday', JSON.stringify(viewedToday));
    updateStats();
}

function toggleFavorite(id) {
    if (favorites.includes(id)) {
        favorites = favorites.filter(fav => fav !== id);
    } else {
        favorites.push(id);
    }
    
    localStorage.setItem('wisdomFavorites', JSON.stringify(favorites));
    displayWisdom();
    updateStats();
}

function toggleFavorites() {
    showingFavorites = !showingFavorites;
    const btn = event.target;
    
    if (showingFavorites) {
        btn.innerHTML = '<i class="fas fa-list"></i> عرض الكل';
        btn.style.background = '#e74c3c';
    } else {
        btn.innerHTML = '<i class="fas fa-heart"></i> المفضلة';
        btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
    }
    
    displayWisdom();
}

function shareWisdom(id) {
    const wisdom = wisdomData.find(w => w.id === id);
    
    if (navigator.share) {
        navigator.share({
            title: 'حكمة إسلامية',
            text: `${wisdom.text}\n\n${wisdom.source}`,
            url: window.location.href
        });
    } else {
        copyWisdom(id);
    }
    
    // Increment shared count
    let sharedCount = parseInt(localStorage.getItem('wisdomSharedCount')) || 0;
    sharedCount++;
    localStorage.setItem('wisdomSharedCount', sharedCount.toString());
    updateStats();
}

function copyWisdom(id) {
    const wisdom = wisdomData.find(w => w.id === id);
    const text = `${wisdom.text}\n\n${wisdom.source}`;
    
    navigator.clipboard.writeText(text).then(() => {
        showNotification('تم نسخ الحكمة بنجاح');
    }).catch(() => {
        showNotification('فشل في النسخ');
    });
}

function enableNotifications() {
    if (window.islamicNotifications) {
        window.islamicNotifications.updateReminderSettings('wisdom', { enabled: true });
        showNotification('تم تفعيل التنبيهات اليومية للحكم الإسلامية');
    } else {
        showNotification('خدمة التنبيهات غير متوفرة');
    }
}

function exportWisdom() {
    const dataToExport = {
        wisdom: wisdomData,
        favorites: favorites,
        stats: {
            totalViewed: viewedToday,
            totalFavorites: favorites.length,
            exportDate: new Date().toISOString()
        }
    };
    
    const dataStr = JSON.stringify(dataToExport, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `islamic-wisdom-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    
    showNotification('تم تصدير الحكم الإسلامية');
}

function setDailyWisdom() {
    const today = new Date().toDateString();
    const lastDate = localStorage.getItem('dailyWisdomDate');
    
    if (lastDate !== today) {
        const dailyWisdom = wisdomData[Math.floor(Math.random() * wisdomData.length)];
        document.getElementById('dailyWisdomText').textContent = dailyWisdom.text;
        document.querySelector('.daily-wisdom .wisdom-source').textContent = dailyWisdom.source;
        
        localStorage.setItem('dailyWisdomDate', today);
        localStorage.setItem('dailyWisdomId', dailyWisdom.id.toString());
    } else {
        const savedId = localStorage.getItem('dailyWisdomId');
        if (savedId) {
            const dailyWisdom = wisdomData.find(w => w.id === parseInt(savedId));
            if (dailyWisdom) {
                document.getElementById('dailyWisdomText').textContent = dailyWisdom.text;
                document.querySelector('.daily-wisdom .wisdom-source').textContent = dailyWisdom.source;
            }
        }
    }
}

function updateStats() {
    document.getElementById('totalWisdom').textContent = wisdomData.length;
    document.getElementById('todayViews').textContent = viewedToday;
    document.getElementById('favoriteCount').textContent = favorites.length;
    
    const sharedCount = localStorage.getItem('wisdomSharedCount') || '0';
    document.getElementById('sharedCount').textContent = sharedCount;
}

function showNotification(message) {
    // Create notification
    const notification = document.createElement('div');
    notification.innerHTML = message;
    notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; background: #28a745; 
        color: white; padding: 15px 25px; border-radius: 8px; 
        z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        transform: translateX(100%); transition: transform 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // Show notification
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    // Hide notification
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Reset daily views at midnight
const now = new Date();
const lastViewDate = localStorage.getItem('wisdomViewDate');
if (lastViewDate !== now.toDateString()) {
    localStorage.setItem('wisdomViewedToday', '0');
    localStorage.setItem('wisdomViewDate', now.toDateString());
    viewedToday = 0;
}
</script>
{% endblock %}
